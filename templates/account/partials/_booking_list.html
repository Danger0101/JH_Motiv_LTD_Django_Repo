{% comment %}
This partial is rendered via HTMX from accounts.views.profile_bookings_partial
It displays a list of session bookings (upcoming, past, or canceled)
{% endcomment %}

{% if user_bookings_page %}
    <ul class="list-disc list-inside space-y-2">
        {% for session in user_bookings_page %}
            <li>
                {{ session.start_datetime|date:"M d, H:i" }} 
                with {{ session.coach.user.get_full_name|default:session.coach.user.username }} 
                (Status: {{ session.status }})
                
                {% if active_tab == 'upcoming' %}
                    <button hx-get="{% url 'coaching_booking:reschedule_session_form' session.id %}" 
                            hx-target="#reschedule-form-container-{{ session.id }}"
                            hx-swap="outerHTML"
                            class="ml-2 px-3 py-1 text-sm font-medium text-blue-600 bg-blue-100 rounded-md hover:bg-blue-200">
                        Reschedule
                    </button>
                    <button hx-post="{% url 'coaching_booking:cancel_session' session.id %}" 
                            hx-confirm="Are you sure you want to cancel this session?"
                            hx-target="#profile-bookings"
                            hx-swap="innerHTML"
                            class="ml-2 px-3 py-1 text-sm font-medium text-red-600 bg-red-100 rounded-md hover:bg-red-200">
                        Cancel
                    </button>
                    <div id="reschedule-form-container-{{ session.id }}"></div>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    {# Pagination controls #}
    <nav class="flex items-center justify-between border-t border-gray-200 px-4 py-3 sm:px-6 mt-4" aria-label="Pagination">
        <div class="flex flex-1 justify-between sm:justify-end">
            {% if user_bookings_page.has_previous %}
                <button hx-get="{% url 'accounts:profile_bookings' %}?tab={{ active_tab }}&page={{ user_bookings_page.previous_page_number }}" 
                        hx-target="#session-list-container" hx-swap="innerHTML"
                        class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">
                    Previous
                </button>
            {% endif %}
            {% if user_bookings_page.has_next %}
                <button hx-get="{% url 'accounts:profile_bookings' %}?tab={{ active_tab }}&page={{ user_bookings_page.next_page_number }}" 
                        hx-target="#session-list-container" hx-swap="innerHTML"
                        class="ml-3 relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">
                    Next
                </button>
            {% endif %}
        </div>
    </nav>

{% else %}
    <p class="text-gray-500 italic">No {{ active_tab }} sessions found.</p>
{% endif %}