{% extends 'base.html' %}

{% block title %}Coach Settings{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-10">
    <h1 class="text-3xl font-bold text-gray-800 mb-8">Coach Settings Dashboard</h1>

    <div x-data="{ tab: 'availability' }">
        <!-- Tab Navigation -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button @click="tab = 'availability'" :class="{ 'border-indigo-500 text-indigo-600': tab === 'availability', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': tab !== 'availability' }"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    Availability
                </button>
                <button @click="tab = 'vacation'" :class="{ 'border-indigo-500 text-indigo-600': tab === 'vacation', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': tab !== 'vacation' }"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    Vacation / Time Off
                </button>
                <button @click="tab = 'my_offerings'" :class="{ 'border-indigo-500 text-indigo-600': tab === 'my_offerings', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': tab !== 'my_offerings' }"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    My Offerings
                </button>
                <button @click="tab = 'all_offerings'" :class="{ 'border-indigo-500 text-indigo-600': tab === 'all_offerings', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': tab !== 'all_offerings' }"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    All Offerings
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div>
            <!-- Availability Tab -->
            <div x-show="tab === 'availability'" x-cloak>
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Manage Availability</h2>
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-3">Weekly Recurring Schedule</h3>
                        <div id="recurring-availability-container" 
                             hx-get="{% url 'coaching:api_recurring_availability' %}" 
                             hx-trigger="load, recurring-schedule-updated from:body" 
                             hx-swap="innerHTML">
                            <p>Loading recurring schedule...</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-3">Specific Date Overrides</h3>
                        <div id="specific-availability-container" 
                             hx-get="{% url 'coaching:api_specific_availability' %}" 
                             hx-trigger="load, specific-slot-updated from:body" 
                             hx-swap="innerHTML">
                            <p>Loading specific slots...</p>
                        </div>
                    </div>
                    {# NEW: Availability Preview Calendar #}
                    <div class="xl:col-span-2 mt-8 border-t pt-8">
                        <h3 class="text-lg font-medium text-gray-900 mb-3">Availability Preview</h3>
                        <p class="text-sm text-gray-600 mb-4">This calendar shows how your current settings translate into bookable slots. It will update automatically when you save changes.</p>
                        {% if default_offering %}
                        <div
                            id="calendar-preview-container"
                            hx-get="{% url 'coaching:api_calendar_view' %}?coach_id={{ user.id }}&offering_id={{ default_offering.id }}"
                            hx-trigger="load, recurring-schedule-updated from:body, specific-slot-updated from:body, vacation-block-updated from:body"
                            hx-swap="innerHTML"
                            class="mt-4 border rounded-lg shadow-md"
                        >
                            <p class="p-4 text-gray-500">Loading availability preview...</p>
                        </div>
                        {% else %}
                        <p class="p-4 text-gray-500 bg-gray-100 rounded-md">Create an offering to see the availability preview.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Vacation Tab -->
            <div x-show="tab === 'vacation'" x-cloak
                 hx-get="{% url 'coaching:api_vacation_blocks' %}"
                 hx-trigger="load, vacation-block-updated from:body, block-deleted from:body"
                 hx-target="this">
                <p>Loading vacation schedule...</p>
            </div>

            <!-- Offerings Tab -->
            <div id="offerings-list-container" x-show="tab === 'my_offerings'" x-cloak
                 hx-get="{% url 'coaching:api_offerings_list_create' %}"
                 hx-trigger="load, offering-updated from:body"
                 hx-target="this">
                <p>Loading offerings...</p>
            </div>

            <!-- All Offerings Tab -->
            <div id="all-offerings-list-container" x-show="tab === 'all_offerings'" x-cloak
                 hx-get="{% url 'coaching:api_all_offerings_list' %}"
                 hx-trigger="load, offering-updated from:body"
                 hx-target="this">
                <p>Loading all available offerings...</p>
            </div>
        </div>
    </div>
</div>

<div id="modal-container"></div>
{% endblock %}