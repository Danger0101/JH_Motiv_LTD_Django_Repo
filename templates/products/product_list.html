{% extends 'base.html' %}
{% load static %}

{% block title %}Shop - JH Motiv LTD{% endblock %}

{% block extra_head %}
<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .animate-fade-in-up {
        animation: fadeInUp 0.8s ease-out forwards;
    }
    /* Force product card images to contain instead of cover/stretch */
    #main-product-grid img {
        object-fit: contain !important;
        background-color: #f9fafb; /* bg-gray-50 */
    }
    /* Fix for loading indicator blocking clicks */
    #product-loading-indicator {
        pointer-events: none;
        opacity: 0;
    }
    #product-loading-indicator.htmx-request {
        pointer-events: auto;
        opacity: 1;
    }
</style>
{% endblock %}

{% block content %}
{# --- Seasonal Banner Logic (Same as Coaching Page) --- #}
{% now "n" as current_month %}
{% if current_month == "3" or current_month == "4" or current_month == "5" %}
    {% static 'images/spring_banner.webp' as hero_image %}
{% elif current_month == "6" or current_month == "7" or current_month == "8" %}
    {% static 'images/summer_banner.webp' as hero_image %}
{% elif current_month == "9" or current_month == "10" or current_month == "11" %}
    {% static 'images/Fall_banner.webp' as hero_image %}
{% else %}
    {% static 'images/winter_banner.webp' as hero_image %}
{% endif %}

{# --- Full Width Hero Banner --- #}
<div class="relative bg-gray-900 h-96 md:h-[32rem] overflow-hidden">
    <div class="absolute inset-0">
        <img id="seasonal-hero-bg" class="w-full h-full object-cover" src="{{ hero_image }}" alt="Shop our collection">
        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/40"></div>
    </div>
    <div class="relative max-w-7xl mx-auto h-full flex flex-col justify-center items-center px-4 sm:px-6 lg:px-8 pb-12">
        <h1 class="text-4xl font-extrabold tracking-tight text-white sm:text-5xl lg:text-6xl text-center" style="text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;">Upgrade Your Inventory</h1>
        <p class="mt-6 text-xl text-white max-w-3xl text-center font-bold" style="text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;">High-stat gear for the daily grind. Boost your confidence +20.</p>
        
        <div class="mt-8 w-full max-w-4xl p-6 bg-white/10 backdrop-blur-lg rounded-2xl animate-fade-in-up">
            <form 
                method="get" 
                action="{% url 'products:product_list' %}" 
                class="grid grid-cols-1 md:grid-cols-12 gap-4 items-center"
                hx-get="{% url 'products:product_list' %}"
                hx-target="#product-list-container"
                hx-swap="innerHTML show:top"
                hx-push-url="true"
                hx-indicator="#product-loading-indicator"
                hx-trigger="submit, change from:#per-page-select, change from:#sort-select"
            >
                <div class="md:col-span-5 lg:col-span-6">
                    <label for="search-input" class="sr-only">Search products</label>
                    <input type="search" name="q" id="search-input" placeholder="Search Item Database..." value="{{ search_query }}" class="w-full px-5 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-inner text-gray-900 placeholder-gray-500">
                </div>
                
                <div class="md:col-span-3 lg:col-span-3">
                    <label for="sort-select" class="sr-only">Sort By</label>
                    <select name="sort" id="sort-select" class="w-full px-5 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-inner text-gray-900 cursor-pointer">
                        <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>Newest Arrivals</option>
                        <option value="price_asc" {% if current_sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
                        <option value="price_desc" {% if current_sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
                        <option value="name_asc" {% if current_sort == 'name_asc' %}selected{% endif %}>Name: A-Z</option>
                        <option value="name_desc" {% if current_sort == 'name_desc' %}selected{% endif %}>Name: Z-A</option>
                    </select>
                </div>

                <div class="md:col-span-4 lg:col-span-3 flex items-center gap-4">
                    <div class="flex-grow">
                        <label for="per-page-select" class="sr-only">Items per page</label>
                        <select name="per_page" id="per-page-select" class="w-full px-5 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-inner text-gray-900 cursor-pointer">
                            <option value="10"{% if per_page == '10' %} selected{% endif %}>10 per page</option>
                            <option value="20"{% if per_page == '20' %} selected{% endif %}>20 per page</option>
                            <option value="50"{% if per_page == '50' %} selected{% endif %}>50 per page</option>
                            <option value="100"{% if per_page == '100' %} selected{% endif %}>100 per page</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-blue-500/50 hover:-translate-y-0.5 whitespace-nowrap" title="Search Products">Scan</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="container mx-auto px-4 sm:px-6 lg:px-8 pb-8 pt-4 relative min-h-[50vh]">
    <div id="product-loading-indicator" class="htmx-indicator absolute inset-0 z-20 flex justify-center items-start pt-32 bg-white/80 backdrop-blur-sm transition-all duration-200 rounded-xl">
        <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="text-lg text-gray-600 font-mono animate-pulse">Scanning for Loot...</span>
    </div>

    <div id="product-list-container"
         hx-indicator="#product-loading-indicator">
        {% include "products/partials/product_list_partial.html" %}
    </div>
</div>
{% endblock %}