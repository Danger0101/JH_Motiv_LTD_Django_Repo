{% extends request.htmx|yesno:"_base_htmx.html,base.html" %}
{% load static %}
{% load i18n allauth %}

{% block title %}Log In{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/account.css' %}">
{% endblock %}

{% block content %}
<div class="auth-page-wrapper">
    <div class="auth-container" id="login-form-container">
        <div class="auth-card">
            <h2 class="auth-title">{% translate "Log In" %}</h2>

            {% url 'account:login' as login_url %}
            
            <form method="post" action="{{ login_url }}" hx-post="{{ login_url }}" hx-target="#login-form-container" hx-swap="outerHTML">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div style="padding: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem; color: #b91c1c; background-color: #fee2e2; border-radius: 0.25rem;" role="alert">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                {% for field in form %}
                    {% if field.name != 'remember' %}
                    <div class="form-group">
                        <label for="{{ field.id_for_label }}" class="form-label">
                            {{ field.label }}
                        </label>
                        {{ field }} 
                        {% if field.errors %}
                            <p style="margin-top: 0.25rem; font-size: 0.75rem; color: #ef4444;">{{ field.errors|striptags }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                {% endfor %}
                
                <div style="text-align: right; margin-bottom: 1rem;">
                    <a class="auth-link" href="{% url 'account:password_reset' %}" style="font-size: 0.875rem;">
                        {% translate "Forgot Password?" %}
                    </a>
                </div>
                
                {% if form.remember %}
                <div class="form-group" style="display: flex; align-items: center;">
                    {{ form.remember }}
                    <label for="{{ form.remember.id_for_label }}" style="margin-left: 0.5rem; font-size: 0.875rem; color: var(--gray-900);">
                        {% translate "Remember Me" %}
                    </label>
                </div>
                {% endif %}

                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                {% endif %}
                
                <button type="submit" class="btn-primary">
                    {% translate "Log In" %}
                </button>
            </form>
            
            {% if ACCOUNT_ALLOW_REGISTRATION %}
            <div class="auth-links">
                <p>
                    {% translate "Don't have an account?" %}
                    <a href="{% url 'account:signup' %}" class="auth-link">
                        {% translate "Sign up here" %}
                    </a>
                </p>
                <p style="margin-top: 1rem;">
                    By logging in, you agree to our
                    <a href="{% url 'core:terms_of_service' %}" class="auth-link">Terms of Service</a> and
                    <a href="{% url 'core:privacy_policy' %}" class="auth-link">Privacy Policy</a>.
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}