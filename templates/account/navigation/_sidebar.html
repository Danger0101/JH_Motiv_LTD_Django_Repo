<aside :class="{'block absolute inset-0 z-40 bg-white p-4 shadow-xl lg:static lg:block lg:shadow-none lg:p-0 lg:bg-transparent': mobileMenuOpen, 'hidden lg:block': !mobileMenuOpen}" 
       class="w-full lg:w-1/4 lg:flex-shrink-0 transition-all duration-300">
    
    <div class="sticky top-6 space-y-2">
        <div class="lg:hidden flex justify-end mb-4">
             <button @click="mobileMenuOpen = false" class="text-gray-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
        </div>

        <p class="px-4 text-xs font-black text-gray-400 uppercase tracking-widest mb-2 font-mono">Character Menu</p>

        {# 1. MAIN MENU (Dashboard) #}
        <button @click="activeTab = 'dashboard'; mobileMenuOpen = false" 
                :class="activeTab === 'dashboard' ? 'bg-blue-50 text-blue-700 border-blue-200' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-transparent'"
                class="w-full flex items-center px-4 py-3 text-sm font-bold border rounded-lg transition-colors">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
            Status / Stats
        </button>

        {# 2. ACTIVE QUESTS (Bookings) #}
        <button @click="activeTab = 'bookings'; mobileMenuOpen = false" 
                :class="activeTab === 'bookings' ? 'bg-blue-50 text-blue-700 border-blue-200' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-transparent'"
                class="w-full flex items-center justify-between px-4 py-3 text-sm font-bold border rounded-lg transition-colors">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                Active Quests
            </div>
            {% if bookings %}
                <span class="{% if has_urgent_booking %}bg-red-600{% else %}bg-blue-600{% endif %} text-white text-xs font-bold px-2 py-0.5 rounded-full shadow-sm">{{ bookings.count }}</span>
            {% endif %}
        </button>

        {# 3. LOOT HISTORY (Orders) #}
        <button @click="activeTab = 'order_history'; mobileMenuOpen = false"
                :class="activeTab === 'order_history' ? 'bg-blue-50 text-blue-700 border-blue-200' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-transparent'"
                class="w-full flex items-center px-4 py-3 text-sm font-bold border rounded-lg transition-colors">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
            Loot History
        </button>

        {% if has_earnings_profile %}
        <button @click="activeTab = 'earnings'; mobileMenuOpen = false" 
                :class="activeTab === 'earnings' ? 'bg-blue-50 text-blue-700 border-blue-200' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-transparent'"
                class="w-full flex items-center px-4 py-3 text-sm font-bold border rounded-lg transition-colors text-left">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            My Payouts
        </button>
        {% endif %}

        {% if is_coach %}
        <p class="px-4 text-xs font-black text-purple-400 uppercase tracking-widest mt-6 mb-2 font-mono">Guild Access</p>
        <button @click="activeTab = 'coach_portal'; mobileMenuOpen = false" 
                :class="activeTab === 'coach_portal' ? 'bg-purple-50 text-purple-700 border-purple-200' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-transparent'"
                class="w-full flex items-center px-4 py-3 text-sm font-bold border rounded-lg transition-colors">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
             Guild Hall
        </button>
        {% endif %}

        {% if is_staff %}
        <p class="px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2">Admin</p>
        <button @click="activeTab = 'staff'; mobileMenuOpen = false" 
                :class="activeTab === 'staff' ? 'bg-red-50 text-red-700 border-red-200' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900 border-transparent'"
                class="w-full flex items-center px-4 py-3 text-sm font-medium border rounded-lg transition-colors">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
            Staff Dashboard
        </button>
        {% endif %}
        
        <div class="pt-6 border-t mt-6">
            <a href="{% url 'accounts:logout' %}" class="w-full flex items-center px-4 py-3 text-sm font-bold text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                Quit Game (Logout)
            </a>
        </div>
    </div>
</aside>