{% load static %}
{% url 'coaching_client:taster_request' as taster_request_url %}

<div class="modal-header">
    <h5 class="modal-title" id="tasterModalLabel">Request Your Free Taster Session ðŸš€</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<form method="post" action="{{ taster_request_url }}" id="taster-request-form">
    <div class="modal-body">
        {% csrf_token %}
        
        {% if request.user.is_authenticated %}
            {# State: Logged In, Ready for One-Click Submit #}
            <div class="alert alert-success py-2">
                We're ready to submit your request instantly using your profile details:
                <br>
                <strong>Name:</strong> {{ request.user.get_full_name }}
                <br>
                <strong>Email:</strong> {{ request.user.email }}
            </div>
            
            <input type="hidden" 
                   name="goal_summary" 
                   value="User submitted a one-click taster session request via the coach page. Goals to be determined in the first contact." />

            <p class="text-muted small">Click 'Submit Request' to confirm. We will contact you via email within 24 hours.</p>

        {% else %}
            {# State: Logged Out - Inform user they need to log in #}
            <div class="alert alert-warning">
                Please <strong>log in or create an account</strong> first to submit your taster session request.
            </div>
        {% endif %}

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" id="submit-taster-btn" {% if not request.user.is_authenticated %}disabled{% endif %}>Submit Request</button>
    </div>
</form>

<script>
    // Simple JS to prevent double submission
    document.getElementById('taster-request-form').addEventListener('submit', function(event) {
        var submitBtn = document.getElementById('submit-taster-btn');
        if (submitBtn.disabled) {
            event.preventDefault(); // Stop submission if button is disabled
            return;
        }
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
    });
</script>