<div class="space-y-4"
     id="booking-list-container"
     hx-get="{% url 'accounts:account_profile' %}" 
     hx-select="#booking-list-container" 
     hx-swap="outerHTML"
     hx-trigger="refreshBookings from:body">
    {% for booking in bookings %}
    <div class="border rounded-lg p-4 bg-white shadow-sm flex flex-col">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center w-full">
            <div>
            <div class="flex items-center gap-2">
                <h3 class="font-bold text-gray-800">{{ booking.offering.name|default:"Coaching Session" }}</h3>
                <span class="px-2 py-0.5 text-xs rounded-full 
                    {% if booking.status == 'BOOKED' or booking.status == 'RESCHEDULED' %}bg-green-100 text-green-800
                    {% elif booking.status == 'PENDING_PAYMENT' %}bg-yellow-100 text-yellow-800
                    {% elif booking.status == 'CANCELED' %}bg-red-100 text-red-800
                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ booking.get_status_display }}
                </span>
            </div>
            <p class="text-sm text-gray-600 mt-1">
                <i class="fas fa-calendar mr-1"></i> {{ booking.start_datetime|date:"F j, Y" }}
                <i class="fas fa-clock ml-3 mr-1"></i> {{ booking.start_datetime|date:"g:i a" }}
            </p>
            <p class="text-sm text-gray-500 mt-1">
                with Coach {{ booking.coach.user.get_full_name }}
            </p>
        </div>
        
        <div class="mt-4 md:mt-0 flex space-x-3">
            {% if booking.status == 'BOOKED' or booking.status == 'RESCHEDULED' %}
                <div x-data="{ open: false }" @close-modal.window="open = false">
                    <button type="button" 
                            @click.stop="open = true" 
                            hx-get="{% url 'coaching_booking:reschedule_session_form' booking.id %}" 
                            hx-target="#profile-reschedule-content-{{ booking.id }}"
                            hx-swap="innerHTML"
                            class="text-indigo-600 hover:text-indigo-800 text-sm font-medium focus:outline-none">
                        Reschedule
                    </button>
                    
                    <div x-show="open" class="fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-50 flex items-center justify-center p-4" style="display: none;" x-cloak>
                        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl overflow-hidden relative" @click.away="open = false">
                            <div id="profile-reschedule-content-{{ booking.id }}" class="h-full">
                                <div class="flex justify-center py-10"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <button 
                        type="button"
                        hx-post="{% url 'coaching_booking:cancel_session' booking.id %}"
                        hx-confirm="Are you sure you want to cancel this session? This action cannot be undone."
                        class="text-red-600 hover:text-red-800 text-sm font-medium focus:outline-none">
                        Cancel
                    </button>
                </div>
            {% endif %}
        </div>
        </div>
    </div>
    {% empty %}
    <p class="text-gray-500 italic">No upcoming bookings found.</p>
    {% endfor %}
</div>