<div class="w-full max-w-md mx-auto fade-in text-left">
    
    <div class="mb-8 border-b border-green-900 pb-4">
        <p class="text-xs text-gray-500 mb-1">> SELECTED_OBJECT:</p>
        <div class="flex justify-between items-end">
            <h3 class="text-xl text-white font-bold">{{ variant.name }}</h3>
            <span class="text-green-400 font-mono text-xl" id="total-display">£{{ total }}</span>
        </div>
    </div>

    <div class="mb-8 bg-green-900/10 border border-dashed border-green-700 p-4 hover:bg-green-900/20 transition-colors">
        <label class="flex items-start cursor-pointer gap-3">
            <input type="checkbox" id="bump-checkbox" class="mt-1 bg-black border-green-500 text-green-500 focus:ring-0 focus:ring-offset-0">
            <div>
                <span class="block text-white font-bold text-sm">>> ADD: THE COMBAT LOG (+£7)</span>
                <span class="block text-xs text-gray-400 mt-1">Digital Workbook. Track your dailies. Audit your stats.</span>
            </div>
        </label>
    </div>

    <form id="payment-form" class="space-y-6">
        
        <div>
            <label class="block text-xs text-green-700 mb-1">EMAIL_ADDRESS</label>
            <input type="email" placeholder="neo@matrix.com" required 
                   class="w-full bg-black border border-green-800 text-green-400 placeholder-green-900/50 text-sm p-3 focus:border-green-400 focus:ring-0">
        </div>

        <div>
            <label class="block text-xs text-green-700 mb-1">CREDIT_INTERFACE</label>
            <div id="card-element" class="bg-black border border-green-800 p-3"></div>
            <div id="card-errors" role="alert" class="text-red-500 text-xs mt-2"></div>
        </div>

        <button id="submit-button" class="w-full bg-green-600 text-black font-bold py-4 hover:bg-white transition-all uppercase tracking-widest mt-4">
            CONFIRM TRANSACTION
        </button>
    </form>

    <div class="mt-4 text-center">
        <button hx-get="{% url 'awakening:step_2_offers' %}" 
                hx-target="#terminal-stage" 
                class="text-xs text-gray-600 hover:text-green-500 underline">
            < RECONFIGURE_LOADOUT
        </button>
    </div>

</div>

<script>
    (function() {
        // Use your existing Stripe Public Key from Django Context
        const stripe = Stripe('{{ stripe_public_key }}');
        const elements = stripe.elements();
        
        // Custom Matrix Styling for Stripe
        const style = {
            base: {
                color: '#00ff41',
                fontFamily: '"VT323", monospace',
                fontSmoothing: 'antialiased',
                fontSize: '18px',
                '::placeholder': { color: '#005f11' }
            },
            invalid: { color: '#ff0000', iconColor: '#ff0000' }
        };

        const card = elements.create('card', {style: style});
        card.mount('#card-element');

        // Handle Errors
        card.addEventListener('change', function(event) {
            const displayError = document.getElementById('card-errors');
            if (event.error) {
                displayError.textContent = '> ERROR: ' + event.error.message;
            } else {
                displayError.textContent = '';
            }
        });

        // NOTE: The actual Submit logic needs to call your backend `payments` API.
        // For this demo, we assume you have a `process_payment` JS function or similar in your base.
        // If not, you will need to copy the logic from `payments/templates/payments/_stripe_form.html`.
    })();
</script>