<div class="space-y-4"
     id="booking-list-container"
     hx-get="{% url 'accounts:account_profile' %}" 
     hx-select="#booking-list-container" 
     hx-swap="outerHTML"
     hx-trigger="refreshBookings from:body">
    {% for booking in bookings %}
    <div class="border rounded-lg p-4 bg-white shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center">
        <div>
            <div class="flex items-center gap-2">
                <h3 class="font-bold text-gray-800">{{ booking.offering.name|default:"Coaching Session" }}</h3>
                <span class="px-2 py-0.5 text-xs rounded-full 
                    {% if booking.status == 'BOOKED' or booking.status == 'RESCHEDULED' %}bg-green-100 text-green-800
                    {% elif booking.status == 'PENDING_PAYMENT' %}bg-yellow-100 text-yellow-800
                    {% elif booking.status == 'CANCELED' %}bg-red-100 text-red-800
                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ booking.get_status_display }}
                </span>
            </div>
            <p class="text-sm text-gray-600 mt-1">
                <i class="fas fa-calendar mr-1"></i> {{ booking.start_datetime|date:"F j, Y" }}
                <i class="fas fa-clock ml-3 mr-1"></i> {{ booking.start_datetime|date:"g:i a" }}
            </p>
            <p class="text-sm text-gray-500 mt-1">
                with Coach {{ booking.coach.user.get_full_name }}
            </p>
        </div>
        
        <div class="mt-4 md:mt-0 flex space-x-3">
            {% if booking.status == 'BOOKED' or booking.status == 'RESCHEDULED' %}
                <div x-data="{ open: false }" 
                     @close-modal.window="open = false" 
                     @keydown.escape.window="open = false">
                    <button 
                        type="button"
                        @click="open = true"
                        hx-get="{% url 'coaching_booking:reschedule_session_form' booking.id %}" 
                        hx-target="#reschedule-modal-{{ booking.id }}"
                        hx-swap="innerHTML"
                        class="text-indigo-600 hover:text-indigo-800 text-sm font-medium focus:outline-none">
                        Reschedule
                    </button>
                    
                    <div x-show="open" style="display: none;" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
                        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                            <div @click="open = false" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
                            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                            <div id="reschedule-modal-{{ booking.id }}" class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl sm:w-full">
                                <div class="p-10 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div x-data="{ open: false }" 
                     @close-modal.window="open = false" 
                     @keydown.escape.window="open = false">
                    <button 
                        type="button"
                        @click="open = true"
                        hx-get="{% url 'coaching_booking:cancel_booking_modal' booking.id %}"
                        hx-target="#cancel-modal-{{ booking.id }}"
                        hx-swap="innerHTML"
                        class="text-red-600 hover:text-red-800 text-sm font-medium focus:outline-none">
                        Cancel
                    </button>
                    
                    <div x-show="open" style="display: none;" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
                        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                            <div @click="open = false" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
                            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                            <div id="cancel-modal-{{ booking.id }}" class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                                <div class="p-10 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <p class="text-gray-500 italic">No upcoming bookings found.</p>
    {% endfor %}
</div>