{% load static %} {% load unicorn %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>{% block title %}JH Motiv LTD{% endblock %}</title>

    <!-- Social Media Meta Tags (Open Graph) -->
    <meta property="og:title" content="{% block og_title %}JH Motiv LTD{% endblock %}" />
    <meta property="og:image" content="{% block og_image %}{% static 'images/default-share.jpg' %}{% endblock %}" />

    <!-- Favicon -->
    <link rel="icon" href="{% static 'favicon.ico' %}" type="image/x-icon">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Local Tailwind CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

    <!-- HTMX and Alpine.js -->
    <script
      src="https://unpkg.com/htmx.org@1.9.10"
      integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC"
      crossorigin="anonymous"
      nonce="{{ csp_nonce }}"
    ></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/class-tools.js" nonce="{{ csp_nonce }}"></script>
    <script
      defer
      src="https://unpkg.com/@alpinejs/csp@3.13.7/dist/cdn.min.js"
      crossorigin="anonymous"
      nonce="{{ csp_nonce }}"
    ></script>

    <style nonce="{{ csp_nonce }}">[x-cloak] { display: none !important; }</style>
    
    {% include 'partials/google_analytics.html' %}

    {% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/carousel.css' %}">
    <style nonce="{{ csp_nonce }}">
      /* Move toast container down to avoid blocking the navbar */
      #toast-container {
        top: 6rem !important; /* Approx 96px */
      }
      /* Loot Drop Theme for Toasts */
      #toast-container > div, [role="alert"] {
        background-color: #111827 !important; /* gray-900 */
        border: 2px solid #f59e0b !important; /* amber-500 */
        color: #f3f4f6 !important;
      }
    </style>
    {% endblock %}
  </head>
  <body
    class="bg-gray-100 text-gray-800 flex flex-col min-h-screen"
    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
    hx-ext="class-tools"
  >
    {% include 'partials/cookie_consent.html' %}

    <!-- Header -->
    {% include 'partials/navbar.html' %}

    <!-- Main Content -->
    <main class="flex-grow flex flex-col">{% block content %}{% endblock %}</main>

    <!-- Footer -->
    {% include 'partials/footer.html' %} {% unicorn_scripts %}
    {% block extra_scripts %}
      <script src="{% static 'js/carousel.js' %}" nonce="{{ csp_nonce }}"></script> 
      <script src="{% static 'js/alpine_components.js' %}" defer nonce="{{ csp_nonce }}"></script>
      <script type="module" src="{% static 'js/cheats/engine.js' %}" nonce="{{ csp_nonce }}"></script>
      
      <script nonce="{{ csp_nonce }}" defer>
        document.addEventListener('alpine:init', () => {
            // Navigation Component
            Alpine.data('navMenu', () => ({
                isOpen: false,
                toggleMenu() { this.isOpen = !this.isOpen },
                get isClosed() { return !this.isOpen }
            }));

            // Account Dropdown Component
            Alpine.data('accountDropdown', () => ({
                dropdownOpen: false,
                toggle() { this.dropdownOpen = !this.dropdownOpen },
                close() { this.dropdownOpen = false },
                get isVisible() { return this.dropdownOpen }
            }));

            // Toast Manager Component
            Alpine.data('toastManager', () => ({
                toasts: [],
                add(e) {
                    const id = Date.now();
                    this.toasts.push({ id: id, ...e.detail, show: true });
                    setTimeout(() => {
                        this.toasts = this.toasts.filter(t => t.id !== id);
                    }, 5000);
                },
                isVisible(toast) {
                    return toast.show;
                }
            }));
        });
      </script>
    {% endblock %}

    {% include 'partials/toast_messages.html' %}
    <div id="slide-over-container"></div>
  </body>
</html>