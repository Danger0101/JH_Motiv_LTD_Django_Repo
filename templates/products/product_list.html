{% extends 'base.html' %}
{% load static %}

{% block title %}Our Products{% endblock %}

{% block extra_head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/products.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="products-header">
        <h1>Our Products</h1>
        <p>Find the perfect gear to support your journey.</p>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <form method="get" class="filter-form">
            <div class="search-group">
                <input type="text" name="q" class="filter-input" placeholder="Search products..." value="{{ request.GET.q }}">
            </div>
            <div>
                <select name="category" class="filter-select">
                    <option value="">All Categories</option>
                    {# Assumes 'categories' are passed in context #}
                    {% for category in categories %}
                        <option value="{{ category.slug }}" {% if request.GET.category == category.slug %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="actions-group">
                <button type="submit" class="btn-search">Filter</button>
            </div>
        </form>
    </div>

    <!-- Product Grid -->
    <div class="product-grid">
        {% for product in page_obj %}
            <div class="product-card">
                <a href="{{ product.get_absolute_url }}" class="card-image-link">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="card-image">
                    {% else %}
                        <div class="image-placeholder">No Image</div>
                    {% endif %}
                </a>
                <div class="card-body">
                    <h2 class="card-title"><a href="{{ product.get_absolute_url }}">{{ product.name }}</a></h2>
                    <p class="card-description">{{ product.description|truncatewords:15 }}</p>
                    <div class="card-footer">
                        <span class="card-price">Â£{{ product.price|floatformat:2 }}</span>
                        <a href="{{ product.get_absolute_url }}" class="btn-details">View Details</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>No products found matching your criteria.</p>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
        <nav class="pagination-nav">
            <div class="pagination-controls">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="btn-page">&larr; Previous</a>
                {% endif %}
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="btn-page">Next &rarr;</a>
                {% endif %}
            </div>
        </nav>
    {% endif %}
</div>
{% endblock %}