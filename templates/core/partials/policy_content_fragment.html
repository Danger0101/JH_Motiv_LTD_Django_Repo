{% load i18n %}
{% comment %}
    This fragment renders only the tabbed policy content (Privacy or TOS) 
    and is designed to be loaded by HTMX into a modal.
    It receives either 'policy_data' (Privacy Policy) or 'tos_data' (Terms of Service).
{% endcomment %}

{# Determine which data dictionary to use #}
{% if policy_data %}
    {% with policy_dictionary=policy_data policy_url_name='privacy_policy' %}
        {# Set policy_type for Alpine.js to select the correct tab content #}
        <div x-data="{ activePolicy: 'retail' }">
            
            <h2 class="text-xl font-bold mb-4 sr-only">Privacy Policy Tabs</h2>

            {# Tab Headers (Simplified for Modal Context) #}
            <div class="flex justify-center border-b border-gray-200" role="tablist" aria-label="Policy Versions">
                <button 
                    @click="activePolicy = 'retail'"
                    :class="{ 'border-blue-500 text-blue-600': activePolicy === 'retail', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activePolicy !== 'retail' }"
                    class="w-1/2 py-2 px-1 text-center border-b-2 font-medium text-sm focus:outline-none"
                    role="tab"
                    aria-controls="pp-retail-panel"
                    :aria-selected="activePolicy === 'retail'"
                >
                    Retail Policy
                </button>
                <button 
                    @click="activePolicy = 'coaching'"
                    :class="{ 'border-blue-500 text-blue-600': activePolicy === 'coaching', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activePolicy !== 'coaching' }"
                    class="w-1/2 py-2 px-1 text-center border-b-2 font-medium text-sm focus:outline-none"
                    role="tab"
                    aria-controls="pp-coaching-panel"
                    :aria-selected="activePolicy === 'coaching'"
                >
                    Coaching Policy
                </button>
            </div>
            
            <div class="mt-4">
                {# RETAIL POLICY PANEL #}
                <div x-show="activePolicy === 'retail'" role="tabpanel" id="pp-retail-panel" aria-labelledby="pp-retail-tab">
                    <h3 class="text-lg font-semibold mb-3 pt-2">{{ policy_dictionary.retail.title }}</h3>
                    <p class="text-xs text-gray-500 mb-6">Effective Date: {{ policy_dictionary.retail.effective_date }}</p>
                    
                    {% for section in policy_dictionary.retail.sections %}
                        <section class="mb-6">
                            <h4 class="text-md font-semibold mb-2">{{ section.heading }}</h4>
                            <div class="text-gray-700 text-sm leading-relaxed space-y-3">
                                {{ section.content|safe }}
                            </div>
                        </section>
                    {% endfor %}
                </div>

                {# COACHING POLICY PANEL #}
                <div x-show="activePolicy === 'coaching'" role="tabpanel" id="pp-coaching-panel" aria-labelledby="pp-coaching-tab" x-cloak>
                    <h3 class="text-lg font-semibold mb-3 pt-2">{{ policy_dictionary.coaching.title }}</h3>
                    <p class="text-xs text-gray-500 mb-6">Effective Date: {{ policy_dictionary.coaching.effective_date }}</p>

                    {% for section in policy_dictionary.coaching.sections %}
                        <section class="mb-6">
                            <h4 class="text-md font-semibold mb-2">{{ section.heading }}</h4>
                            <div class="text-gray-700 text-sm leading-relaxed space-y-3">
                                {{ section.content|safe }}
                            </div>
                        </section>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endwith %}

{# RENDER TERMS OF SERVICE (TOS) #}
{% elif tos_data %}
    {% with policy_dictionary=tos_data policy_url_name='terms_of_service' %}
        {# Set policy_type for Alpine.js to select the correct tab content #}
        <div x-data="{ activePolicy: 'retail' }">

            <h2 class="text-xl font-bold mb-4 sr-only">Terms of Service Tabs</h2>

            {# Tab Headers #}
            <div class="flex justify-center border-b border-gray-200" role="tablist" aria-label="Terms Versions">
                <button 
                    @click="activePolicy = 'retail'"
                    :class="{ 'border-blue-500 text-blue-600': activePolicy === 'retail', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activePolicy !== 'retail' }"
                    class="w-1/2 py-2 px-1 text-center border-b-2 font-medium text-sm focus:outline-none"
                    role="tab"
                    aria-controls="tos-retail-panel"
                    :aria-selected="activePolicy === 'retail'"
                >
                    Retail & General Terms
                </button>
                <button 
                    @click="activePolicy = 'coaching'"
                    :class="{ 'border-blue-500 text-blue-600': activePolicy === 'coaching', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activePolicy !== 'coaching' }"
                    class="w-1/2 py-2 px-1 text-center border-b-2 font-medium text-sm focus:outline-none"
                    role="tab"
                    aria-controls="tos-coaching-panel"
                    :aria-selected="activePolicy === 'coaching'"
                >
                    Coaching Terms
                </button>
            </div>
            
            <div class="mt-4">
                {# RETAIL TOS PANEL #}
                <div x-show="activePolicy === 'retail'" role="tabpanel" id="tos-retail-panel" aria-labelledby="tos-retail-tab">
                    <h3 class="text-lg font-semibold mb-3 pt-2">{{ policy_dictionary.retail.title }}</h3>
                    <p class="text-xs text-gray-500 mb-6">Effective Date: {{ policy_dictionary.retail.effective_date }}</p>
                    
                    {% for section in policy_dictionary.retail.sections %}
                        <section class="mb-6">
                            <h4 class="text-md font-semibold mb-2">{{ section.heading }}</h4>
                            <div class="text-gray-700 text-sm leading-relaxed space-y-3">
                                {{ section.content|safe }}
                            </div>
                        </section>
                    {% endfor %}
                </div>

                {# COACHING TOS PANEL #}
                <div x-show="activePolicy === 'coaching'" role="tabpanel" id="tos-coaching-panel" aria-labelledby="tos-coaching-tab" x-cloak>
                    <h3 class="text-lg font-semibold mb-3 pt-2">{{ policy_dictionary.coaching.title }}</h3>
                    <p class="text-xs text-gray-500 mb-6">Effective Date: {{ policy_dictionary.coaching.effective_date }}</p>

                    {% for section in policy_dictionary.coaching.sections %}
                        <section class="mb-6">
                            <h4 class="text-md font-semibold mb-2">{{ section.heading }}</h4>
                            <div class="text-gray-700 text-sm leading-relaxed space-y-3">
                                {{ section.content|safe }}
                            </div>
                        </section>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endwith %}
{% else %}
    <p class="text-center text-red-500">Error: No policy data was provided.</p>
{% endif %}